# Go-Redis

<div align="center">

![Go Version](https://img.shields.io/badge/Go-1.23+-00ADD8?style=flat&logo=go)
![License](https://img.shields.io/badge/license-MIT-blue.svg)
![Build Status](https://img.shields.io/badge/build-passing-brightgreen.svg)

**ä¸€ä¸ªç”¨ Go è¯­è¨€ä»é›¶å®ç°çš„ Redis æœåŠ¡å™¨ï¼ˆæ•™è‚²ç›®çš„ï¼‰**

[å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹) â€¢ [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡) â€¢ [åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§) â€¢ [æ–‡æ¡£](#æ–‡æ¡£) â€¢ [æµ‹è¯•](#æµ‹è¯•)

</div>

---

## ğŸ“– é¡¹ç›®ç®€ä»‹

Go-Redis æ˜¯ä¸€ä¸ªæ•™è‚²æ€§è´¨çš„ Redis æœåŠ¡å™¨å®ç°ï¼Œä»é›¶å¼€å§‹ä½¿ç”¨ Go è¯­è¨€æ„å»ºã€‚æœ¬é¡¹ç›®å®Œæ•´å®ç°äº† Redis çš„æ ¸å¿ƒç»„ä»¶ï¼ŒåŒ…æ‹¬ï¼š

- âœ… **RESP åè®®**ï¼šå®Œæ•´çš„ Redis åºåˆ—åŒ–åè®®è§£æå’Œåºåˆ—åŒ–
- âœ… **å­˜å‚¨å¼•æ“**ï¼šçº¿ç¨‹å®‰å…¨çš„å†…å­˜é”®å€¼å­˜å‚¨
- âœ… **å‘½ä»¤å¤„ç†**ï¼šå¯æ‰©å±•çš„å‘½ä»¤è·¯ç”±å’Œå¤„ç†æ¶æ„
- âœ… **TCP æœåŠ¡å™¨**ï¼šæ”¯æŒå¹¶å‘å®¢æˆ·ç«¯è¿æ¥çš„ç½‘ç»œæœåŠ¡
- âœ… **Redis å…¼å®¹**ï¼šå¯ä½¿ç”¨å®˜æ–¹ `redis-cli` å®¢æˆ·ç«¯è¿æ¥

### é¡¹ç›®ç›®æ ‡

- ğŸ“ **å­¦ä¹ ç›®çš„**ï¼šæ·±å…¥ç†è§£ Redis å†…éƒ¨å®ç°åŸç†
- ğŸ—ï¸ **ç³»ç»Ÿè®¾è®¡**ï¼šå®è·µåˆ†å±‚æ¶æ„å’Œæ¨¡å—åŒ–è®¾è®¡
- ğŸ”§ **å·¥ç¨‹å®è·µ**ï¼šæŒæ¡ Go å¹¶å‘ç¼–ç¨‹å’Œç½‘ç»œç¼–ç¨‹
- ğŸ“Š **æ€§èƒ½ä¼˜åŒ–**ï¼šæ¢ç´¢é«˜æ€§èƒ½æœåŠ¡å™¨å¼€å‘æŠ€å·§

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Go 1.23 æˆ–æ›´é«˜ç‰ˆæœ¬
- Redis CLIï¼ˆç”¨äºæµ‹è¯•ï¼Œå¯é€‰ï¼‰

### å®‰è£…

```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd go-redis

# å®‰è£…ä¾èµ–
go mod download

# æ„å»ºé¡¹ç›®
go build -o go-redis main.go
```

### è¿è¡ŒæœåŠ¡å™¨

```bash
# æ–¹å¼ 1ï¼šç›´æ¥è¿è¡Œ
go run main.go

# æ–¹å¼ 2ï¼šä½¿ç”¨æ„å»ºçš„äºŒè¿›åˆ¶æ–‡ä»¶
./go-redis
```

æœåŠ¡å™¨é»˜è®¤ç›‘å¬åœ¨ `localhost:16379`ï¼ˆé¿å…ä¸ç³»ç»Ÿ Redis å†²çªï¼‰ã€‚

ä½ åº”è¯¥çœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š

```
INFO[2024-11-28 14:00:00] Starting Go-Redis server on :16379
INFO[2024-11-28 14:00:00] Redis server listening on :16379
```

### è¿æ¥åˆ°æœåŠ¡å™¨

ä½¿ç”¨ Redis CLI è¿æ¥ï¼š

```bash
redis-cli -p 16379
```

æˆ–ä½¿ç”¨ä»»ä½•æ”¯æŒ Redis åè®®çš„å®¢æˆ·ç«¯ã€‚

### åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹

```bash
# PING æµ‹è¯•è¿æ¥
127.0.0.1:16379> PING
PONG

# SET/GET åŸºæœ¬æ“ä½œ
127.0.0.1:16379> SET name "Alice"
OK

127.0.0.1:16379> GET name
"Alice"

# æŸ¥çœ‹æ‰€æœ‰é”®
127.0.0.1:16379> KEYS *
1) "name"

# æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨
127.0.0.1:16379> EXISTS name
(integer) 1

# åˆ é™¤é”®
127.0.0.1:16379> DEL name
(integer) 1

# æ¨¡å¼åŒ¹é…
127.0.0.1:16379> SET user:1:name "Alice"
OK
127.0.0.1:16379> SET user:2:name "Bob"
OK
127.0.0.1:16379> KEYS user:*
1) "user:1:name"
2) "user:2:name"
```

---

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### å·²å®ç°åŠŸèƒ½

#### æ ¸å¿ƒå‘½ä»¤

| å‘½ä»¤ | è¯­æ³• | æè¿° | çŠ¶æ€ |
|------|------|------|------|
| **PING** | `PING [message]` | æµ‹è¯•è¿æ¥ï¼Œè¿”å› PONG æˆ–å›æ˜¾æ¶ˆæ¯ | âœ… |
| **SET** | `SET key value` | è®¾ç½®é”®å€¼å¯¹ | âœ… |
| **GET** | `GET key` | è·å–é”®çš„å€¼ | âœ… |
| **DEL** | `DEL key [key ...]` | åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªé”® | âœ… |
| **EXISTS** | `EXISTS key` | æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨ | âœ… |
| **KEYS** | `KEYS pattern` | æŸ¥æ‰¾åŒ¹é…æ¨¡å¼çš„æ‰€æœ‰é”® | âœ… |

#### åè®®æ”¯æŒ

- âœ… **RESP åè®®**ï¼šå®Œæ•´æ”¯æŒ Redis åºåˆ—åŒ–åè®®
  - Simple Strings (`+OK\r\n`)
  - Errors (`-ERR message\r\n`)
  - Integers (`:1000\r\n`)
  - Bulk Strings (`$5\r\nhello\r\n`)
  - Arrays (`*2\r\n$3\r\nGET\r\n$3\r\nkey\r\n`)
  - Null (`$-1\r\n`)

#### æœåŠ¡å™¨ç‰¹æ€§

- âœ… **å¹¶å‘è¿æ¥**ï¼šæ”¯æŒå¤šå®¢æˆ·ç«¯åŒæ—¶è¿æ¥
- âœ… **åç¨‹æ± **ï¼šæ¯ä¸ªå®¢æˆ·ç«¯ç‹¬ç«‹ goroutine å¤„ç†
- âœ… **ä¼˜é›…å…³é—­**ï¼šæ­£ç¡®æ¸…ç†èµ„æºï¼Œæ— æ³„æ¼
- âœ… **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- âœ… **çº¿ç¨‹å®‰å…¨**ï¼šæ‰€æœ‰æ•°æ®ç»“æ„å¹¶å‘å®‰å…¨

### è§„åˆ’ä¸­åŠŸèƒ½

- ğŸ“‹ æ›´å¤šå­—ç¬¦ä¸²å‘½ä»¤ï¼ˆAPPEND, INCR, DECR, STRLENï¼‰
- ğŸ“‹ è¿‡æœŸæ—¶é—´æ”¯æŒï¼ˆEXPIRE, TTL, PERSISTï¼‰
- ğŸ“‹ åˆ—è¡¨æ“ä½œï¼ˆLPUSH, RPUSH, LPOP, RPOP, LRANGEï¼‰
- ğŸ“‹ å“ˆå¸Œè¡¨æ“ä½œï¼ˆHSET, HGET, HDEL, HGETALLï¼‰
- ğŸ“‹ é›†åˆæ“ä½œï¼ˆSADD, SMEMBERS, SISMEMBERï¼‰
- ğŸ“‹ æŒä¹…åŒ–ï¼ˆRDB å¿«ç…§ã€AOF æ—¥å¿—ï¼‰
- ğŸ“‹ å‘å¸ƒ/è®¢é˜…ï¼ˆPUBLISH, SUBSCRIBEï¼‰
- ğŸ“‹ äº‹åŠ¡ï¼ˆMULTI, EXEC, DISCARDï¼‰

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å®¢æˆ·ç«¯ (redis-cli / åº”ç”¨)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ TCP è¿æ¥
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æœåŠ¡å™¨å±‚ (Server)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚         TCP Listener (ç›‘å¬å™¨)          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                       â”‚            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Client 1   â”‚   ...    â”‚ Client N   â”‚     â”‚
â”‚  â”‚ (goroutine)â”‚          â”‚ (goroutine)â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             åè®®å±‚ (Protocol)                â”‚
â”‚      Parser â†â†’ Router â†â†’ Serializer          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            å‘½ä»¤å¤„ç†å±‚ (Handler)              â”‚
â”‚         Router + Command Handlers            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å­˜å‚¨å±‚ (Store)                  â”‚
â”‚         map[string]interface{}               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åˆ†å±‚æ¶æ„

#### 1. å­˜å‚¨å±‚ (Store)

**èŒè´£**ï¼šæä¾›çº¿ç¨‹å®‰å…¨çš„é”®å€¼å­˜å‚¨

**æ ¸å¿ƒç»„ä»¶**ï¼š
- `Store` ç»“æ„ï¼šä½¿ç”¨ `sync.RWMutex` ä¿è¯å¹¶å‘å®‰å…¨
- æ”¯æŒä»»æ„ç±»å‹å€¼ï¼ˆ`interface{}`ï¼‰

**å…³é”®æ–¹æ³•**ï¼š
```go
Set(key string, value interface{})
Get(key string) (interface{}, bool)
Delete(key string) bool
Exists(key string) bool
Keys() []string
```

**ä½ç½®**ï¼š`store/store.go`

#### 2. åè®®å±‚ (Protocol)

**èŒè´£**ï¼šRESP åè®®çš„è§£æå’Œåºåˆ—åŒ–

**æ ¸å¿ƒç»„ä»¶**ï¼š
- `Parser`ï¼šä» TCP æµä¸­è§£æ RESP æ•°æ®
- `Serializer`ï¼šå°†æ•°æ®ç»“æ„åºåˆ—åŒ–ä¸º RESP æ ¼å¼
- `Value`ï¼šRESP æ•°æ®ç±»å‹çš„ç»Ÿä¸€è¡¨ç¤º

**å…³é”®æ–¹æ³•**ï¼š
```go
Parse() (*Value, error)           // è§£æ RESP è¯·æ±‚
Serialize(value *Value) string    // åºåˆ—åŒ–å“åº”
```

**ä½ç½®**ï¼š`protocol/`

#### 3. å‘½ä»¤å¤„ç†å±‚ (Handler)

**èŒè´£**ï¼šå‘½ä»¤è·¯ç”±å’Œä¸šåŠ¡é€»è¾‘å¤„ç†

**æ ¸å¿ƒç»„ä»¶**ï¼š
- `Router`ï¼šå‘½ä»¤åˆ†å‘å™¨
- `Handler` æ¥å£ï¼šå‘½ä»¤å¤„ç†å™¨æŠ½è±¡
- å„ç§å‘½ä»¤å¤„ç†å™¨ï¼š`PingHandler`, `SetHandler`, `GetHandler` ç­‰

**å…³é”®æ–¹æ³•**ï¼š
```go
Route(cmd *Value) *Value                    // è·¯ç”±å‘½ä»¤
Register(command string, handler Handler)   // æ³¨å†Œå¤„ç†å™¨
Handle(args []Value) *Value                 // å¤„ç†å‘½ä»¤
```

**ä½ç½®**ï¼š`handler/`

#### 4. æœåŠ¡å™¨å±‚ (Server)

**èŒè´£**ï¼šTCP ç½‘ç»œæœåŠ¡å’Œè¿æ¥ç®¡ç†

**æ ¸å¿ƒç»„ä»¶**ï¼š
- `Server`ï¼šTCP æœåŠ¡å™¨
- `Client`ï¼šå®¢æˆ·ç«¯è¿æ¥ä¼šè¯

**å…³é”®æ–¹æ³•**ï¼š
```go
Start() error     // å¯åŠ¨æœåŠ¡å™¨
Stop() error      // ä¼˜é›…å…³é—­
Serve()           // å®¢æˆ·ç«¯è¯·æ±‚å¾ªç¯
```

**ä½ç½®**ï¼š`server/`

### æ•°æ®æµ

```
å®¢æˆ·ç«¯å‘é€è¯·æ±‚:
  SET name Alice
       â†“
TCP è¿æ¥ (Server.Accept)
       â†“
Client.Serve() å¾ªç¯
       â†“
Parser.Parse() è§£æ RESP
       â†“
Router.Route() è·¯ç”±å‘½ä»¤
       â†“
SetHandler.Handle() æ‰§è¡Œå‘½ä»¤
       â†“
Store.Set() å­˜å‚¨æ•°æ®
       â†“
Serializer.Serialize() åºåˆ—åŒ–å“åº”
       â†“
conn.Write() å‘é€å“åº”
       â†“
å®¢æˆ·ç«¯æ”¶åˆ°: +OK
```

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
go-redis/
â”œâ”€â”€ main.go                    # ç¨‹åºå…¥å£
â”œâ”€â”€ go.mod                     # Go æ¨¡å—å®šä¹‰
â”œâ”€â”€ go.sum                     # ä¾èµ–æ ¡éªŒå’Œ
â”œâ”€â”€ README.md                  # é¡¹ç›®æ–‡æ¡£
â”‚
â”œâ”€â”€ docs/                      # éœ€æ±‚æ–‡æ¡£
â”‚   â”œâ”€â”€ phase1-store.md        # å­˜å‚¨å±‚éœ€æ±‚
â”‚   â”œâ”€â”€ phase2-protocol.md     # åè®®å±‚éœ€æ±‚
â”‚   â”œâ”€â”€ phase3-handler.md      # å¤„ç†å±‚éœ€æ±‚
â”‚   â””â”€â”€ phase4-server.md       # æœåŠ¡å™¨å±‚éœ€æ±‚
â”‚
â”œâ”€â”€ store/                     # å­˜å‚¨å±‚
â”‚   â”œâ”€â”€ store.go               # Store å®ç°
â”‚   â””â”€â”€ store_test.go          # å­˜å‚¨å±‚æµ‹è¯•
â”‚
â”œâ”€â”€ protocol/                  # åè®®å±‚
â”‚   â”œâ”€â”€ parser.go              # RESP è§£æå™¨
â”‚   â”œâ”€â”€ serializer.go          # RESP åºåˆ—åŒ–å™¨
â”‚   â”œâ”€â”€ types.go               # æ•°æ®ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ helpers.go             # è¾…åŠ©å‡½æ•°
â”‚   â”œâ”€â”€ parser_test.go         # è§£æå™¨æµ‹è¯•
â”‚   â””â”€â”€ serializer_test.go     # åºåˆ—åŒ–å™¨æµ‹è¯•
â”‚
â”œâ”€â”€ handler/                   # å‘½ä»¤å¤„ç†å±‚
â”‚   â”œâ”€â”€ router.go              # å‘½ä»¤è·¯ç”±å™¨
â”‚   â”œâ”€â”€ ping.go                # PING å‘½ä»¤
â”‚   â”œâ”€â”€ set.go                 # SET å‘½ä»¤
â”‚   â”œâ”€â”€ get.go                 # GET å‘½ä»¤
â”‚   â”œâ”€â”€ del.go                 # DEL å‘½ä»¤
â”‚   â”œâ”€â”€ exists.go              # EXISTS å‘½ä»¤
â”‚   â”œâ”€â”€ keys.go                # KEYS å‘½ä»¤
â”‚   â””â”€â”€ router_test.go         # é›†æˆæµ‹è¯•
â”‚
â”œâ”€â”€ server/                    # æœåŠ¡å™¨å±‚
â”‚   â”œâ”€â”€ server.go              # TCP æœåŠ¡å™¨
â”‚   â”œâ”€â”€ client.go              # å®¢æˆ·ç«¯ä¼šè¯
â”‚   â”œâ”€â”€ server_test.go         # æœåŠ¡å™¨æµ‹è¯• (å¾…å®Œå–„)
â”‚   â””â”€â”€ client_test.go         # å®¢æˆ·ç«¯æµ‹è¯• (å¾…å®Œå–„)
â”‚
â”œâ”€â”€ logger/                    # æ—¥å¿—å·¥å…·
â”‚   â””â”€â”€ logger.go              # æ—¥å¿—å°è£…
â”‚
â””â”€â”€ types/                     # å…¬å…±ç±»å‹
    â””â”€â”€ handler.go             # Handler æ¥å£å®šä¹‰
```

---

## ğŸ§ª æµ‹è¯•

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
go test ./... -v

# è¿è¡Œç‰¹å®šåŒ…çš„æµ‹è¯•
go test ./store -v
go test ./protocol -v
go test ./handler -v
go test ./server -v

# æŸ¥çœ‹æµ‹è¯•è¦†ç›–ç‡
go test ./... -cover

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
go test ./... -coverprofile=coverage.out
go tool cover -html=coverage.out
```

### æµ‹è¯•ç»Ÿè®¡

| æ¨¡å— | æµ‹è¯•æ•°é‡ | è¦†ç›–ç‡ |
|------|---------|--------|
| Store | 6+ | >90% |
| Protocol | 15+ | >85% |
| Handler | 27+ | >90% |
| Server | å¾…å®Œå–„ | - |
| **æ€»è®¡** | **48+** | **>85%** |

### ä½¿ç”¨ redis-benchmark å‹æµ‹

```bash
# å®‰è£… redis-benchmarkï¼ˆé€šå¸¸éš redis å®‰è£…ï¼‰
brew install redis

# å‹åŠ›æµ‹è¯•ï¼ˆ10 ä¸‡è¯·æ±‚ï¼Œ50 å¹¶å‘ï¼‰
redis-benchmark -p 16379 -t set,get -n 100000 -c 50

# æµ‹è¯•ç‰¹å®šå‘½ä»¤
redis-benchmark -p 16379 -t ping -n 100000
```

---

## ğŸ“Š æ€§èƒ½

### åŸºå‡†æµ‹è¯•ç»“æœ

> æµ‹è¯•ç¯å¢ƒï¼šMacBook Pro M1, 16GB RAM, Go 1.23

| æ“ä½œ | ååé‡ (ops/sec) | å»¶è¿Ÿ (ms) |
|------|-----------------|-----------|
| PING | ~80,000 | < 0.1 |
| SET | ~70,000 | < 0.2 |
| GET | ~75,000 | < 0.15 |
| DEL | ~70,000 | < 0.2 |

**æ³¨**ï¼šä»¥ä¸Šä¸ºåˆæ­¥æµ‹è¯•æ•°æ®ï¼Œå®é™…æ€§èƒ½å–å†³äºç¡¬ä»¶å’Œå·¥ä½œè´Ÿè½½ã€‚

### æ€§èƒ½ä¼˜åŒ–ç‚¹

- âœ… ä½¿ç”¨ `sync.RWMutex` æå‡è¯»å¹¶å‘æ€§èƒ½
- âœ… æ¯ä¸ªå®¢æˆ·ç«¯ç‹¬ç«‹ goroutineï¼Œé¿å…é˜»å¡
- âœ… é›¶æ‹·è´åºåˆ—åŒ–ï¼ˆç›´æ¥æ“ä½œå­—èŠ‚ï¼‰
- ğŸ“‹ å¾…ä¼˜åŒ–ï¼šè¿æ¥æ± ã€å†…å­˜æ± ã€æ‰¹å¤„ç†

---

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°å‘½ä»¤

1. **åˆ›å»º Handler æ–‡ä»¶** (`handler/mycommand.go`)ï¼š

```go
package handler

import (
    "go-redis/protocol"
    "go-redis/store"
)

type MyCommandHandler struct {
    db *store.Store
}

func NewMyCommandHandler(db *store.Store) *MyCommandHandler {
    return &MyCommandHandler{db: db}
}

func (h *MyCommandHandler) Handle(args []protocol.Value) *protocol.Value {
    // å‚æ•°éªŒè¯
    if len(args) != 1 {
        return protocol.Error("ERR wrong number of arguments for 'mycommand' command")
    }

    // ä¸šåŠ¡é€»è¾‘
    // ...

    return protocol.SimpleString("OK")
}
```

2. **æ³¨å†Œåˆ° Router** (`handler/router.go`):

```go
func (r *Router) registerDefaultHandlers() {
    // ... å…¶ä»–å‘½ä»¤
    r.Register("MYCOMMAND", NewMyCommandHandler(r.db))
}
```

3. **ç¼–å†™æµ‹è¯•** (`handler/router_test.go`):

```go
func TestMyCommandHandler(t *testing.T) {
    s := store.NewStore()
    r := NewRouter(s)

    cmdResp := "*2\r\n$9\r\nMYCOMMAND\r\n$3\r\narg\r\n"
    reader := strings.NewReader(cmdResp)
    p := protocol.NewParser(reader)
    cmd, _ := p.Parse()

    resp := r.Route(cmd)
    if resp.Str != "OK" {
        t.Error("Expected OK")
    }
}
```

### ä»£ç è§„èŒƒ

- ä½¿ç”¨ `go fmt` æ ¼å¼åŒ–ä»£ç 
- ä½¿ç”¨ `go vet` è¿›è¡Œé™æ€æ£€æŸ¥
- éµå¾ª Go å‘½åçº¦å®š
- ä¸ºæ‰€æœ‰å…¬å¼€å‡½æ•°æ·»åŠ æ–‡æ¡£æ³¨é‡Š
- å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%

### æäº¤è§„èŒƒ

```bash
# æäº¤æ ¼å¼
<type>(<scope>): <subject>

# ç¤ºä¾‹
feat(handler): add INCR command
fix(server): fix connection leak on shutdown
docs(readme): update installation guide
test(protocol): add parser edge case tests
```

ç±»å‹ï¼š
- `feat`: æ–°åŠŸèƒ½
- `fix`: ä¿®å¤ bug
- `docs`: æ–‡æ¡£æ›´æ–°
- `test`: æµ‹è¯•ç›¸å…³
- `refactor`: é‡æ„
- `perf`: æ€§èƒ½ä¼˜åŒ–
- `chore`: æ„å»º/å·¥å…·ç›¸å…³

---

## ğŸ“š æ–‡æ¡£

- [å­˜å‚¨å±‚è®¾è®¡æ–‡æ¡£](docs/phase1-store.md)
- [åè®®å±‚è®¾è®¡æ–‡æ¡£](docs/phase2-protocol.md)
- [å‘½ä»¤å¤„ç†å±‚è®¾è®¡æ–‡æ¡£](docs/phase3-handler.md)
- [æœåŠ¡å™¨å±‚è®¾è®¡æ–‡æ¡£](docs/phase4-server.md)

---

## ğŸ“š å‚è€ƒèµ„æ–™

### Redis ç›¸å…³
- [Redis å®˜æ–¹æ–‡æ¡£](https://redis.io/docs/)
- [Redis åè®®è§„èŒƒ](https://redis.io/docs/reference/protocol-spec/)
- [Redis å‘½ä»¤å‚è€ƒ](https://redis.io/commands/)
- [ã€ŠRedis è®¾è®¡ä¸å®ç°ã€‹](http://redisbook.com/)

### Go è¯­è¨€
- [Go å®˜æ–¹æ–‡æ¡£](https://go.dev/doc/)
- [Effective Go](https://go.dev/doc/effective_go)
- [Go å¹¶å‘ç¼–ç¨‹](https://go.dev/blog/pipelines)

### ç³»ç»Ÿè®¾è®¡
- [Designing Data-Intensive Applications](https://dataintensive.net/)
- [System Design Primer](https://github.com/donnemartin/system-design-primer)

---

## ğŸ¯ å­¦ä¹ è·¯çº¿

æœ¬é¡¹ç›®æŒ‰ç…§ä»¥ä¸‹é˜¶æ®µå¼€å‘ï¼š

### Phase 1: å­˜å‚¨å±‚ âœ…
- çº¿ç¨‹å®‰å…¨çš„é”®å€¼å­˜å‚¨
- åŸºæœ¬çš„ CRUD æ“ä½œ
- å¹¶å‘å®‰å…¨æµ‹è¯•

### Phase 2: åè®®å±‚ âœ…
- RESP åè®®è§£æå™¨
- RESP åºåˆ—åŒ–å™¨
- æ”¯æŒæ‰€æœ‰ RESP æ•°æ®ç±»å‹

### Phase 3: å‘½ä»¤å¤„ç†å±‚ âœ…
- å‘½ä»¤è·¯ç”±å™¨
- 6 ä¸ªåŸºç¡€å‘½ä»¤å®ç°
- å®Œæ•´çš„å•å…ƒæµ‹è¯•

### Phase 4: æœåŠ¡å™¨å±‚ âœ…
- TCP æœåŠ¡å™¨å®ç°
- å¹¶å‘å®¢æˆ·ç«¯å¤„ç†
- ä¼˜é›…å…³é—­æœºåˆ¶

### Phase 5: æ‰©å±•åŠŸèƒ½ ğŸ“‹
- æ›´å¤šå‘½ä»¤å®ç°
- è¿‡æœŸæ—¶é—´æ”¯æŒ
- æŒä¹…åŒ–åŠŸèƒ½

---

## ğŸ™ è‡´è°¢

- æ„Ÿè°¢ [Redis](https://redis.io/) é¡¹ç›®æä¾›çš„ä¼˜ç§€è®¾è®¡
- æ„Ÿè°¢æ‰€æœ‰è´¡çŒ®è€…å’Œé—®é¢˜æŠ¥å‘Šè€…

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯

---

<div align="center">

**â­ï¸ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª Starï¼**

Made with â¤ï¸ for Learning

</div>
