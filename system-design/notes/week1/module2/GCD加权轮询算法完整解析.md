# GCD åŠ æƒè½®è¯¢ç®—æ³•å®Œæ•´è§£æ

> **æ ¸å¿ƒç‰¹ç‚¹**ï¼šé€šè¿‡é˜ˆå€¼é€’å‡å’ŒGCDæ­¥é•¿ï¼Œå®ç°æŒ‰æƒé‡æ¯”ä¾‹åˆ†é…ï¼Œå†…å­˜é«˜æ•ˆä½†ä¸å¤Ÿå¹³æ»‘

---

## ğŸ“‹ ç›®å½•

1. [ç®—æ³•æ¦‚è¿°](#1-ç®—æ³•æ¦‚è¿°)
2. [æ ¸å¿ƒæ•°å­¦åŸç†](#2-æ ¸å¿ƒæ•°å­¦åŸç†)
3. [å®Œæ•´ä»£ç å®ç°](#3-å®Œæ•´ä»£ç å®ç°)
4. [æ€»ç»“](#4-æ€»ç»“)

---

## 1. ç®—æ³•æ¦‚è¿°

### 1.1 åŸºæœ¬æ€æƒ³

ä½¿ç”¨ä¸€ä¸ª**å…¨å±€é˜ˆå€¼** `curWeight` ä»æœ€å¤§æƒé‡é€’å‡åˆ°æœ€å°æƒé‡ï¼Œæ¯æ¬¡é€‰æ‹©æƒé‡ >= é˜ˆå€¼çš„æœåŠ¡å™¨ï¼š

```
æ ¸å¿ƒå˜é‡ï¼š
- curWeight: å½“å‰æƒé‡é˜ˆå€¼ï¼ˆä» maxWeight é€’å‡åˆ° gcdï¼‰
- gcdWeight: æ‰€æœ‰æƒé‡çš„æœ€å¤§å…¬çº¦æ•°ï¼ˆé€’å‡æ­¥é•¿ï¼‰
- maxWeight: æœ€å¤§æƒé‡å€¼

é€‰æ‹©è§„åˆ™ï¼š
while true:
  éå†æœåŠ¡å™¨åˆ—è¡¨
  if å›åˆ°ç´¢å¼•0: curWeight -= gcdWeight
  if server.weight >= curWeight: é€‰æ‹©è¯¥æœåŠ¡å™¨
```

### 1.2 æ‰§è¡Œç¤ºä¾‹

**æƒé‡é…ç½®**ï¼šA:5, B:1, C:1, maxWeight=5, gcd=1

| è¯·æ±‚ | curWeight | éå† | æœåŠ¡å™¨ | weight | æ˜¯å¦é€‰ä¸­ | åŸå›  |
|------|-----------|------|--------|--------|----------|------|
| #1 | 5 | A | A | 5 | âœ… | 5 >= 5 |
| #2 | 4 | A | A | 5 | âœ… | 5 >= 4 |
| #3 | 3 | A | A | 5 | âœ… | 5 >= 3 |
| #4 | 2 | A | A | 5 | âœ… | 5 >= 2 |
| #5 | 1 | A | A | 5 | âœ… | 5 >= 1 |
| #6 | 1 | B | B | 1 | âœ… | 1 >= 1 |
| #7 | 1 | C | C | 1 | âœ… | 1 >= 1 |

**é€‰æ‹©åºåˆ—**ï¼šA A A A A B C â†’ ä¸å¹³æ»‘ï¼

**ç»Ÿè®¡**ï¼šAé€‰ä¸­5æ¬¡ï¼ŒBé€‰ä¸­1æ¬¡ï¼ŒCé€‰ä¸­1æ¬¡ â†’ 5:1:1 âœ“

**å‘¨æœŸæ€§**ï¼šé˜ˆå€¼åºåˆ— 5â†’4â†’3â†’2â†’1â†’5... å¾ªç¯

---

## 2. æ ¸å¿ƒæ•°å­¦åŸç†

### 2.1 ä¸ºä»€ä¹ˆä½¿ç”¨ GCDï¼ˆæœ€å¤§å…¬çº¦æ•°ï¼‰ï¼Ÿ

#### å®šç†ï¼šGCD æ­¥é•¿å®Œæ•´æ€§å®šç†

**å‘½é¢˜**ï¼šå¯¹äºæƒé‡é›†åˆ {wâ‚, wâ‚‚, ..., wâ‚™}ï¼Œè®¾ g = gcd(wâ‚, wâ‚‚, ..., wâ‚™)ï¼Œåˆ™ï¼š
- ä» maxWeight å¼€å§‹ï¼Œæ¯æ¬¡å‡å°‘ gï¼Œèƒ½å¤Ÿç²¾ç¡®è¦†ç›–æ‰€æœ‰æœåŠ¡å™¨çš„"æ¿€æ´»ç‚¹"
- ä»»ä½•å°äº g çš„æ­¥é•¿ä¼šäº§ç”Ÿå†—ä½™è½®æ¬¡
- ä»»ä½•å¤§äº g çš„æ­¥é•¿ä¼šé—æ¼æŸäº›æƒé‡çº§åˆ«

**è¯æ˜**ï¼š

**1. å®Œæ•´æ€§**
```
å› ä¸º g | wáµ¢ï¼ˆg æ•´é™¤æ‰€æœ‰ wáµ¢ï¼‰ï¼Œ
æ‰€ä»¥æ¯ä¸ªæƒé‡éƒ½å¯ä»¥è¡¨ç¤ºä¸ºï¼šwáµ¢ = káµ¢ Ã— g

é˜ˆå€¼åºåˆ—ï¼šmaxWeight, maxWeight-g, maxWeight-2g, ..., 2g, g

å½“ curWeight = káµ¢ Ã— g æ—¶ï¼Œ
æœåŠ¡å™¨ i ç¬¬ä¸€æ¬¡æ»¡è¶³ wáµ¢ >= curWeight

â†’ æ‰€æœ‰æœåŠ¡å™¨éƒ½ä¼šåœ¨æŸä¸ªé˜ˆå€¼è¢«æ¿€æ´» âœ“
```

**2. æœ€ä¼˜æ€§**
```
å¦‚æœæ­¥é•¿ d < g:
  éœ€è¦æ›´å¤šæ­¥æ•°ï¼Œäº§ç”Ÿå†—ä½™é˜ˆå€¼
  ä¾‹å¦‚ï¼šæƒé‡ 6,4,2, gcd=2
  æ­¥é•¿1: 6â†’5â†’4â†’3â†’2 (5æ­¥ï¼Œ5å’Œ3å†—ä½™)
  æ­¥é•¿2: 6â†’4â†’2 (3æ­¥ï¼Œæ— å†—ä½™) âœ“

å¦‚æœæ­¥é•¿ d > g:
  æŸäº›æƒé‡æ°¸è¿œä¸ä¼šè¢«ç²¾ç¡®åŒ¹é…
  ä¾‹å¦‚ï¼šæƒé‡ 6,4,2, gcd=2
  æ­¥é•¿3: 6â†’3 (é—æ¼é˜ˆå€¼4ï¼ŒBæ— æ³•å•ç‹¬æ¿€æ´»)

åªæœ‰ d = g æ—¶ï¼Œæ­¥æ•°æœ€å°‘ä¸”ä¸é—æ¼ âœ“
```

---

### 2.2 ä¸ºä»€ä¹ˆä» MaxWeight å¼€å§‹é€’å‡ï¼Ÿ

#### å®šç†ï¼šé˜ˆå€¼é€’å‡é¡ºåºå®šç†

**å‘½é¢˜**ï¼šä»æœ€å¤§æƒé‡é€’å‡åˆ°æœ€å°æƒé‡ï¼Œèƒ½å¤Ÿç¡®ä¿ï¼š
1. é«˜æƒé‡æœåŠ¡å™¨åœ¨æ¯ä¸ªé˜ˆå€¼çº§åˆ«éƒ½èƒ½è¢«é€‰ä¸­
2. ä½æƒé‡æœåŠ¡å™¨åªåœ¨è¾ƒä½é˜ˆå€¼æ—¶è¢«é€‰ä¸­
3. æ€»é€‰ä¸­æ¬¡æ•°ä¸æƒé‡æˆæ­£æ¯”

**æ•°å­¦æ¨å¯¼**ï¼š

è®¾ n ä¸ªæœåŠ¡å™¨ï¼Œæƒé‡ä¸º wâ‚ â‰¥ wâ‚‚ â‰¥ ... â‰¥ wâ‚™

**æœåŠ¡å™¨ i çš„é€‰ä¸­æ¬¡æ•°**ï¼š
```
æœåŠ¡å™¨ i åœ¨é˜ˆå€¼ t æ—¶è¢«é€‰ä¸­ âŸº wáµ¢ >= t

æ»¡è¶³æ¡ä»¶çš„é˜ˆå€¼ï¼š{gcd, 2Ã—gcd, ..., âŒŠwáµ¢/gcdâŒ‹Ã—gcd}

é€‰ä¸­æ¬¡æ•° Náµ¢ = wáµ¢/gcd
```

**æ€»è¯·æ±‚æ•°**ï¼š
```
æ€»è¯·æ±‚æ•° = n Ã— (maxWeight/gcd)

ï¼ˆå› ä¸ºæœ‰ maxWeight/gcd ä¸ªé˜ˆå€¼çº§åˆ«ï¼Œæ¯çº§è½®è¯¢ n æ¬¡ï¼‰
```

**é€‰ä¸­æ¯”ä¾‹**ï¼š
```
Náµ¢ / æ€»è¯·æ±‚æ•° = (wáµ¢/gcd) / [n Ã— (maxWeight/gcd)]
              = wáµ¢ / (n Ã— maxWeight)

ç­‰ç­‰ï¼Œè¿™ä¸ªä¸å¯¹ï¼è®©æˆ‘é‡æ–°æ¨å¯¼...
```

**æ­£ç¡®æ¨å¯¼**ï¼š

åœ¨ä¸€ä¸ªå®Œæ•´å‘¨æœŸå†…ï¼š
- é˜ˆå€¼çº§åˆ«æ•° = maxWeight/gcd
- æ¯ä¸ªçº§åˆ«è½®è¯¢æœåŠ¡å™¨åˆ—è¡¨

æœåŠ¡å™¨ i åœ¨é˜ˆå€¼ t æ—¶è¢«é€‰ä¸­ âŸº wáµ¢ >= t

```
åœ¨é˜ˆå€¼ = maxWeight æ—¶ï¼šåªæœ‰ w = maxWeight çš„æœåŠ¡å™¨è¢«é€‰
åœ¨é˜ˆå€¼ = maxWeight-gcd æ—¶ï¼šw >= maxWeight-gcd çš„æœåŠ¡å™¨è¢«é€‰
...
åœ¨é˜ˆå€¼ = gcd æ—¶ï¼šæ‰€æœ‰æœåŠ¡å™¨éƒ½è¢«é€‰

æœåŠ¡å™¨ i åœ¨æ»¡è¶³ wáµ¢ >= t çš„æ‰€æœ‰é˜ˆå€¼çº§åˆ«è¢«é€‰ä¸­ä¸€æ¬¡

æ»¡è¶³æ¡ä»¶çš„é˜ˆå€¼çº§åˆ«æ•° = wáµ¢/gcd

â†’ æœåŠ¡å™¨ i çš„æ€»é€‰ä¸­æ¬¡æ•° = wáµ¢/gcd
```

**æ€»é€‰ä¸­æ¬¡æ•°**ï¼š
```
âˆ‘Náµ¢ = âˆ‘(wáµ¢/gcd) = (âˆ‘wáµ¢)/gcd = totalWeight/gcd
```

**é€‰ä¸­æ¯”ä¾‹**ï¼š
```
Náµ¢ / âˆ‘Náµ¢ = (wáµ¢/gcd) / (totalWeight/gcd)
          = wáµ¢ / totalWeight  âœ“

æ¯”ä¾‹æ­£ç¡®ï¼
```

---

### 2.3 åˆ†å±‚æ¿€æ´»æœºåˆ¶

**å…³é”®æ´å¯Ÿ**ï¼šGCDç®—æ³•é€šè¿‡é˜ˆå€¼å°†æœåŠ¡å™¨åˆ†å±‚

```
å±‚çº§ k çš„é˜ˆå€¼åŒºé—´ï¼š(kÃ—gcd, (k+1)Ã—gcd]
æœåŠ¡å™¨ i å±äºå±‚çº§ï¼šâŒˆwáµ¢/gcdâŒ‰
```

**ç¤ºä¾‹ï¼ˆA:6, B:4, C:2, GCD=2ï¼‰**ï¼š

```
å±‚çº§ 3 (é˜ˆå€¼ > 4)ï¼šåªæœ‰ A(6)
å±‚çº§ 2 (é˜ˆå€¼ > 2)ï¼šA(6), B(4)
å±‚çº§ 1 (é˜ˆå€¼ > 0)ï¼šA(6), B(4), C(2)

æ‰§è¡Œè¿‡ç¨‹ï¼š
é˜ˆå€¼=6: Aè¢«é€‰
é˜ˆå€¼=4: Aè¢«é€‰, Bè¢«é€‰
é˜ˆå€¼=2: Aè¢«é€‰, Bè¢«é€‰, Cè¢«é€‰

æ¯ä¸ªå±‚çº§è½®è¯¢ n æ¬¡åï¼Œé˜ˆå€¼ä¸‹é™åˆ°ä¸‹ä¸€å±‚
```

---

### 2.4 å‘¨æœŸæ€§å®šç†

**å®šç†**ï¼šGCDç®—æ³•ä»¥å›ºå®šå‘¨æœŸé‡å¤

**å‘¨æœŸé•¿åº¦**ï¼š
```
cycle = n Ã— (maxWeight/gcd)
```

**è¯æ˜**ï¼š
```
é˜ˆå€¼çº§åˆ«æ•° = maxWeight/gcd
æ¯ä¸ªçº§åˆ«è½®è¯¢ n æ¬¡ï¼ˆéå†æ‰€æœ‰æœåŠ¡å™¨ï¼‰
â†’ æ€»è½®è¯¢æ¬¡æ•° = (maxWeight/gcd) Ã— n

å‘¨æœŸç»“æŸæ¡ä»¶ï¼š
curWeight é™åˆ° 0 åé‡ç½®ä¸º maxWeight
curIdx å›åˆ°åˆå§‹ä½ç½®
```

---

## 3. å®Œæ•´ä»£ç å®ç°

```go
package main

import (
	"errors"
	"fmt"
	"sync"
)

// GcdServer GCDåŠ æƒæœåŠ¡å™¨
type GcdServer struct {
	URL    string
	Name   string
	Weight int // æƒé‡
}

// GcdBalancer GCDåŠ æƒè½®è¯¢è´Ÿè½½å‡è¡¡å™¨
type GcdBalancer struct {
	servers   []*GcdServer
	curIdx    int // å½“å‰ç´¢å¼•
	curWeight int // å½“å‰æƒé‡é˜ˆå€¼
	gcdWeight int // GCDæ­¥é•¿
	maxWeight int // æœ€å¤§æƒé‡
	mu        sync.Mutex
}

// gcd è®¡ç®—æœ€å¤§å…¬çº¦æ•°ï¼ˆæ¬§å‡ é‡Œå¾—ç®—æ³•ï¼‰
func gcd(a, b int) int {
	for b != 0 {
		a, b = b, a%b
	}
	return a
}

// NewGcdBalancer åˆ›å»ºGCDåŠ æƒè½®è¯¢è´Ÿè½½å‡è¡¡å™¨
func NewGcdBalancer(configs []struct{ Name, URL string; Weight int }) *GcdBalancer {
	if len(configs) == 0 {
		return nil
	}

	servers := make([]*GcdServer, 0, len(configs))
	maxWeight := 0
	gcdWeight := configs[0].Weight

	for _, cfg := range configs {
		servers = append(servers, &GcdServer{
			URL:    cfg.URL,
			Name:   cfg.Name,
			Weight: cfg.Weight,
		})

		if cfg.Weight > maxWeight {
			maxWeight = cfg.Weight
		}
		gcdWeight = gcd(gcdWeight, cfg.Weight)
	}

	return &GcdBalancer{
		servers:   servers,
		curIdx:    -1, // ä»-1å¼€å§‹ï¼Œç¬¬ä¸€æ¬¡++åä¸º0
		curWeight: 0,  // åˆå§‹0ï¼Œç¬¬ä¸€æ¬¡ä¼šé‡ç½®ä¸ºmaxWeight
		gcdWeight: gcdWeight,
		maxWeight: maxWeight,
	}
}

// GetServer è·å–ä¸‹ä¸€ä¸ªæœåŠ¡å™¨ï¼ˆæ ¸å¿ƒç®—æ³•ï¼‰
func (b *GcdBalancer) GetServer() (*GcdServer, error) {
	if len(b.servers) == 0 {
		return nil, errors.New("no server available")
	}

	b.mu.Lock()
	defer b.mu.Unlock()

	for {
		// ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªæœåŠ¡å™¨
		b.curIdx = (b.curIdx + 1) % len(b.servers)

		// å¦‚æœå›åˆ°ç¬¬ä¸€ä¸ªæœåŠ¡å™¨ï¼Œé™ä½æƒé‡é˜ˆå€¼
		if b.curIdx == 0 {
			b.curWeight -= b.gcdWeight

			// å¦‚æœæƒé‡é™åˆ°0æˆ–æ›´ä½ï¼Œé‡ç½®ä¸ºæœ€å¤§å€¼
			if b.curWeight <= 0 {
				b.curWeight = b.maxWeight
			}
		}

		// æ£€æŸ¥å½“å‰æœåŠ¡å™¨çš„æƒé‡æ˜¯å¦æ»¡è¶³é˜ˆå€¼
		if b.servers[b.curIdx].Weight >= b.curWeight {
			return b.servers[b.curIdx], nil
		}

		// ä¸æ»¡è¶³åˆ™ç»§ç»­å¾ªç¯
	}
}

// GetStats è·å–å½“å‰çŠ¶æ€ï¼ˆè°ƒè¯•ç”¨ï¼‰
func (b *GcdBalancer) GetStats() string {
	b.mu.Lock()
	defer b.mu.Unlock()

	return fmt.Sprintf("curWeight=%d, curIdx=%d",
		b.curWeight, b.curIdx)
}

// ç¤ºä¾‹ä½¿ç”¨
func main() {
	// åˆ›å»ºè´Ÿè½½å‡è¡¡å™¨ï¼ˆæƒé‡ 5:1:1ï¼‰
	balancer := NewGcdBalancer([]struct{ Name, URL string; Weight int }{
		{"Server-A", "http://192.168.1.1:8080", 5},
		{"Server-B", "http://192.168.1.2:8080", 1},
		{"Server-C", "http://192.168.1.3:8080", 1},
	})

	fmt.Println("GCD åŠ æƒè½®è¯¢æ¼”ç¤ºï¼ˆæƒé‡ 5:1:1ï¼‰")
	fmt.Printf("GCD=%d, MaxWeight=%d\n\n", 1, 5)

	// æ¨¡æ‹Ÿä¸€ä¸ªå®Œæ•´å‘¨æœŸï¼ˆ7æ¬¡è¯·æ±‚ï¼‰
	stats := make(map[string]int)
	sequence := ""

	for i := 1; i <= 7; i++ {
		server, _ := balancer.GetServer()
		stats[server.Name]++
		sequence += server.Name[7:8] + " " // æå– A/B/C

		fmt.Printf("è¯·æ±‚ #%d â†’ %s | %s\n",
			i, server.Name, balancer.GetStats())
	}

	fmt.Printf("\né€‰æ‹©åºåˆ—: %s\n", sequence)
	fmt.Println("\nç»Ÿè®¡ç»“æœ:")
	for name, count := range stats {
		fmt.Printf("  %s: %d æ¬¡\n", name, count)
	}

	fmt.Println("\nâœ“ æ¯”ä¾‹æ­£ç¡®ï¼Œä½†ä¸å¤Ÿå¹³æ»‘ï¼ˆè¿ç»­é€‰æ‹©Aï¼‰")

	// è¯¦ç»†é˜ˆå€¼å˜åŒ–
	fmt.Println("\né˜ˆå€¼å˜åŒ–è¿‡ç¨‹:")
	fmt.Println("è¯·æ±‚ #1-5: curWeight=5,4,3,2,1 â†’ åªæœ‰Aæ»¡è¶³")
	fmt.Println("è¯·æ±‚ #6: curWeight=1 â†’ Bæ»¡è¶³")
	fmt.Println("è¯·æ±‚ #7: curWeight=1 â†’ Cæ»¡è¶³")
}

/*
è¾“å‡º:
GCD åŠ æƒè½®è¯¢æ¼”ç¤ºï¼ˆæƒé‡ 5:1:1ï¼‰
GCD=1, MaxWeight=5

è¯·æ±‚ #1 â†’ Server-A | curWeight=5, curIdx=0
è¯·æ±‚ #2 â†’ Server-A | curWeight=4, curIdx=0
è¯·æ±‚ #3 â†’ Server-A | curWeight=3, curIdx=0
è¯·æ±‚ #4 â†’ Server-A | curWeight=2, curIdx=0
è¯·æ±‚ #5 â†’ Server-A | curWeight=1, curIdx=0
è¯·æ±‚ #6 â†’ Server-B | curWeight=1, curIdx=1
è¯·æ±‚ #7 â†’ Server-C | curWeight=1, curIdx=2

é€‰æ‹©åºåˆ—: A A A A A B C

ç»Ÿè®¡ç»“æœ:
  Server-A: 5 æ¬¡
  Server-B: 1 æ¬¡
  Server-C: 1 æ¬¡

âœ“ æ¯”ä¾‹æ­£ç¡®ï¼Œä½†ä¸å¤Ÿå¹³æ»‘ï¼ˆè¿ç»­é€‰æ‹©Aï¼‰

é˜ˆå€¼å˜åŒ–è¿‡ç¨‹:
è¯·æ±‚ #1-5: curWeight=5,4,3,2,1 â†’ åªæœ‰Aæ»¡è¶³
è¯·æ±‚ #6: curWeight=1 â†’ Bæ»¡è¶³
è¯·æ±‚ #7: curWeight=1 â†’ Cæ»¡è¶³
*/
```

---

## 4. æ€»ç»“

### 4.1 æ ¸å¿ƒæœºåˆ¶

```
é˜ˆå€¼é€’å‡ï¼š
curWeight: maxWeight â†’ maxWeight-gcd â†’ ... â†’ gcd â†’ maxWeight

åˆ†å±‚é€‰æ‹©ï¼š
æ¯ä¸ªé˜ˆå€¼çº§åˆ«è½®è¯¢æœåŠ¡å™¨åˆ—è¡¨
é€‰æ‹© weight >= curWeight çš„æœåŠ¡å™¨
```

### 4.2 æ•°å­¦ä¿è¯

| å®šç† | æ•°å­¦è¡¨è¾¾ | ä½œç”¨ |
|------|---------|------|
| **GCDå®Œæ•´æ€§** | g\|wáµ¢ â†’ æ‰€æœ‰æƒé‡æ˜¯gçš„å€æ•° | ç²¾ç¡®è¦†ç›–ï¼Œæ— é—æ¼ |
| **é˜ˆå€¼é€’å‡** | curWeight -= gcd | é€å±‚æ¿€æ´»æœåŠ¡å™¨ |
| **æ¯”ä¾‹å®ˆæ’** | Náµ¢/âˆ‘Náµ¢ = wáµ¢/totalWeight | ä¿è¯ç²¾ç¡®æ¯”ä¾‹ |
| **å‘¨æœŸæ€§** | cycle = n Ã— (maxWeight/gcd) | çŠ¶æ€å®Œå…¨å¤åŸ |

### 4.3 ä¼˜ç¼ºç‚¹

#### ä¼˜ç‚¹ âœ…

1. **å†…å­˜é«˜æ•ˆ**ï¼šO(n) ç©ºé—´ï¼Œæ— éœ€å±•å¼€åˆ—è¡¨
2. **å®ç°ç›¸å¯¹ç®€å•**ï¼šå•ä¸€é˜ˆå€¼ï¼Œé€»è¾‘æ¸…æ™°
3. **æ¯”ä¾‹ç²¾ç¡®**ï¼šæ•°å­¦ä¿è¯ä¸¥æ ¼æ¯”ä¾‹
4. **æ”¯æŒå¤§æƒé‡**ï¼šæƒé‡1000:1ä¹Ÿå¯é«˜æ•ˆå¤„ç†

#### ç¼ºç‚¹ âŒ

1. **ä¸å¤Ÿå¹³æ»‘**ï¼šé«˜æƒé‡æœåŠ¡å™¨è¿ç»­å‡ºç°
   ```
   è¾“å‡ºï¼šA A A A A B C
   é—®é¢˜ï¼šè¿ç»­5ä¸ªAï¼Œç”¨æˆ·ä½“éªŒä¸ä½³
   ```

2. **GCD=1 æ—¶é€€åŒ–**ï¼šæ•ˆç‡æ¥è¿‘Naiveæ–¹æ³•
   ```
   æƒé‡äº’è´¨æ—¶ï¼Œgcd=1
   é˜ˆå€¼çº§åˆ«æ•° = maxWeight/1 = maxWeight
   éå†æ¬¡æ•°è¾ƒå¤š
   ```

3. **æœ‰æ— æ•ˆéå†**ï¼šéœ€è¦å¾ªç¯æŸ¥æ‰¾æ»¡è¶³æ¡ä»¶çš„æœåŠ¡å™¨
   ```
   æ—¶é—´å¤æ‚åº¦ï¼šO(nÃ—k)ï¼Œkä¸ºé˜ˆå€¼çº§åˆ«æ•°
   ```

### 4.4 é€‚ç”¨åœºæ™¯

#### æ¨èä½¿ç”¨ âœ…
- æƒé‡å·®è·å¤§ï¼ˆå¦‚ 100:10:1ï¼‰
- æƒé‡æœ‰å…¬çº¦æ•°ï¼ˆGCD > 1ï¼‰
- å†…å­˜å—é™åœºæ™¯
- å¯å®¹å¿çŸ­æ—¶é—´çªå‘æµé‡

#### ä¸æ¨èä½¿ç”¨ âŒ
- è¦æ±‚æµé‡å¹³æ»‘åˆ†å¸ƒ
- æƒé‡äº’è´¨ï¼ˆGCD=1ï¼‰
- å¯¹ç”¨æˆ·ä½“éªŒè¦æ±‚é«˜

**æ¨èæ›¿ä»£**ï¼šNGINX å¹³æ»‘åŠ æƒè½®è¯¢

### 4.5 ä¸å¹³æ»‘åŠ æƒè½®è¯¢å¯¹æ¯”

| ç»´åº¦ | GCD åŠ æƒè½®è¯¢ | å¹³æ»‘åŠ æƒè½®è¯¢ |
|------|-------------|-------------|
| **æ ¸å¿ƒæ€æƒ³** | é˜ˆå€¼é€’å‡è¿‡æ»¤ | åŠ¨æ€æƒé‡ç«äº‰ |
| **çŠ¶æ€å˜é‡** | curWeightï¼ˆå…¨å±€é˜ˆå€¼ï¼‰ | æ¯ä¸ªæœåŠ¡å™¨çš„ curWeight |
| **é€‰æ‹©é€»è¾‘** | weight >= curWeight | max(curWeight) |
| **æƒé‡æ›´æ–°** | é˜ˆå€¼é€’å‡ gcd | curWeight += weight, é€‰ä¸­å -= totalWeight |
| **æ•°å­¦åŸç†** | åˆ†å±‚æ¿€æ´» | å……æ”¾ç”µå¹³è¡¡ |
| **å¹³æ»‘æ€§** | âŒ å·® | âœ… ä¼˜ç§€ |
| **å®ç°å¤æ‚åº¦** | ç®€å• | ä¸­ç­‰ |
| **å†…å­˜å ç”¨** | O(1) é¢å¤– | O(n) é¢å¤– |
| **é€‚ç”¨åœºæ™¯** | å†…å­˜å—é™ | é€šç”¨åœºæ™¯ |

**é€‰æ‹©å»ºè®®**ï¼š
```
å¦‚æœè¦æ±‚å¹³æ»‘åº¦ â†’ ä½¿ç”¨å¹³æ»‘åŠ æƒè½®è¯¢
å¦‚æœå†…å­˜å—é™ â†’ ä½¿ç”¨ GCD åŠ æƒè½®è¯¢
```

---

**æ•°å­¦ä¹‹ç¾**ï¼šé€šè¿‡ GCD çš„æ•´é™¤æ€§è´¨ï¼Œä»¥æœ€å°æ­¥é•¿ç²¾ç¡®è¦†ç›–æ‰€æœ‰æƒé‡çº§åˆ«ï¼

**è¿™å°±æ˜¯ GCD åŠ æƒè½®è¯¢ç®—æ³•çš„å®Œæ•´è§£æã€‚** ğŸ¯
