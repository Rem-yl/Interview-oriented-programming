# Ch07 事务
在一个苛刻的数据存储环境中可能会遇到许多可能出错的情况；为了实现可靠的系统，我们必须问题发生时不会发生系统级的失效。

**事务技术**一直是简化这些问题的首选机制；其通过将程序的多个读、写操作作为一个逻辑操作单元。事务中的操作是一个执行的整体，整个事务要么执行成功（提交）、要么全部失败（中止或者回滚）。这样应用层就不必过于担心各种失败的情况，简化了应用层的编程模型。

## 深入理解事务

### ACID的含义
- 原子性（ Atomicity ）
- 一致性（ Consistency ）
- 隔离性（ Isolation ）
- 持久性（ Durability ）

#### Atomicity(原子性)

- 一个事务（Transaction）中的所有操作要么全部成功执行，要么全部不执行。
- 中间状态对外不可见，系统必须保证“不可分割的最小执行单位”。

表现出来的特征：在出错时中止事务，并将部分完成的写入全部丢弃。

#### Consistency(一致性)

**一致性（Consistency）指的是事务执行前后，数据库必须保持合法的状态，即遵循所有定义的约束条件（Constraints）和规则。**

- 数据库在任何时刻都必须满足完整性约束（如主键、外键、唯一性、非空约束等）。
- 一个事务的执行不能破坏数据库的完整性。
- 如果事务成功提交，数据库从一个一致性状态转变到另一个一致性状态；如果事务失败回滚，数据库仍保持在之前的一致性状态。


原子性、隔离性和持久性是数据库自身的属性，但是一致性更多的是应用层的属性。

#### Isolation(隔离性)

**隔离性（Isolation）指的是一个事务的执行不应该被其他事务干扰，即并发事务之间相互隔离，使得每个事务都仿佛是独占数据库在执行。**

- 并发执行的事务，其结果应该与这些事务 串行执行 的结果相同。
- 事务的中间状态对其他事务不可见，只有事务提交后，结果才会对其他事务可见。

#### Durability(持久性)

**持久性（Durability）指的是：事务一旦成功提交，对数据库所做的修改就是永久性的，并且在系统故障（如断电、宕机）后仍能保证数据不丢失。**

换句话说，提交后的数据必须被可靠地记录在稳定存储（如磁盘、SSD）中，而不仅仅在内存中。